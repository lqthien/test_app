function Common(){var a=function(m){return document.getElementById(m)};this.goto_arena=function(){l("?s=Battle&ss=ar")};this.goto_ring=function(){l("?s=Battle&ss=rb")};this.goto_grindfest=function(){l("?s=Battle&ss=gr")};this.goto_crysfest=function(){l("?s=Battle&ss=cf")};this.goto_itemworld=function(){l("?s=Battle&ss=iw")};var l=function(m){var n=MAIN_URL+m;if(document.location==n){a("form_reload").submit()}else{document.location=n}};this.findPos=function(n){var o=0;var m=0;if(n.offsetParent){do{o+=n.offsetLeft;m+=n.offsetTop}while(n=n.offsetParent)}return[o,m]};this.findPosWithScroll=function(n){var o=0;var m=0;if(n.offsetParent){do{o+=n.offsetLeft+(n.scrollLeft?n.scrollLeft:0);m+=n.offsetTop+(n.scrollTop?n.scrollTop:0)}while(n=n.offsetParent)}return[o,m]};this.findScrollOffset=function(n){var o=0;var m=0;if(n.offsetParent){do{o+=n.scrollLeft?n.scrollLeft:0;m+=n.scrollTop?n.scrollTop:0}while(n=n.offsetParent)}return[o,m]};this.getCursorPosition=function(n){n=n||window.event;var o={x:0,y:0};if(n.pageX||n.pageY){o.x=n.pageX;o.y=n.pageY}else{var q=document.documentElement;var m=document.body;o.x=n.clientX+(q.scrollLeft||m.scrollLeft)-(q.clientLeft||0);o.y=n.clientY+(q.scrollTop||m.scrollTop)-(q.clientTop||0)}return o};this.decimalround=function(n,o){var m=Math.round(n*Math.pow(10,o))/Math.pow(10,o);return m};this.show_popup_box=function(A,u,B,w,q,C,z,v,m,s){var n=a("popup_box");var y=[0,0];var o=[0,0];var t=0;if(A!=undefined){t=A.offsetWidth;y=common.findPosWithScroll(A);if(s!=""){var r=a(s);o[0]=r.scrollLeft;o[1]=r.scrollTop}}else{}n.style.left=(u=="right"?y[0]-o[0]+t+B:y[0]-o[0]-B-q)+"px";n.style.top=(y[1]-o[1]+w)+"px";n.style.width=q+"px";n.style.height=C+"px";n.innerHTML='<div style="font-weight:bold; text-align:center; padding-bottom:3px; margin-bottom:5px; font-size:120%; border-bottom:1px solid #A47C78">'+z+'</div><div style="text-align:justify; margin-bottom:5px">'+v+'</div><div style="font-weight:bold">'+m+"</div>";n.style.visibility="visible"};this.hide_popup_box=function(){a("popup_box").style.visibility="hidden"};var h=undefined;var d=0;var j=0;var e=0;var b=function(){var m=h.scrollTop;h.scrollTop=d>0?Math.min(h.scrollTop+e,j):Math.max(h.scrollTop-e,j);if(m!=h.scrollTop){setTimeout(b,1)}else{h=undefined;d=0;j=0}};this.scrollpane_up=function(o,n,m){if(h==undefined){h=a(o);d=-1;j=Math.max(0,h.scrollTop-n);e=m!=undefined?1000:25;b()}};this.scrollpane_down=function(o,n,m){if(h==undefined){h=a(o);d=1;j=h.scrollTop+n;e=m!=undefined?1000:25;b()}};this.hookEvent=function(n,m,o){if(typeof(n)=="string"){n=document.getElementById(n)}if(n==null){return}if(n.addEventListener){if(m=="mousewheel"){n.addEventListener("DOMMouseScroll",o,false)}n.addEventListener(m,o,false)}else{if(n.attachEvent){n.attachEvent("on"+m,o)}}};this.unhookEvent=function(n,m,o){if(typeof(n)=="string"){n=document.getElementById(n)}if(n==null){return}if(n.removeEventListener){if(m=="mousewheel"){n.removeEventListener("DOMMouseScroll",o,false)}n.removeEventListener(m,o,false)}else{if(n.detachEvent){n.detachEvent("on"+m,o)}}};this.cancelEvent=function(m){m=m?m:window.event;if(m.stopPropagation){m.stopPropagation()}if(m.preventDefault){m.preventDefault()}m.cancelBubble=true;m.cancel=true;m.returnValue=false;return false};this.number_format=function(n){n+="";x=n.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var m=/(\d+)(\d{3})/;while(m.test(x1)){x1=x1.replace(m,"$1,$2")}return x1+x2};var k=[9,5,10,10,10,10,10,10,9,9,4,4,5,10,11,8,8,8,11,11,4,4,4];this.get_dynamic_digit_string=function(n){var r=this.number_format(n);var m="";var q=0;for(var o=r.length-1;o>=0;o--){var s=0;if(r.charAt(o)==","){s=11}else{if(r.charAt(o)=="."){s=10}else{if(r.charAt(o)=="+"){s=15}else{if(r.charAt(o)==":"){s=22}else{if(r.charAt(o)=="-"){s=16}else{s=parseInt(r.charAt(o))}}}}}m=m+'<div style="float:right; margin:0; padding:0; height:12px; width:'+(k[s]+1)+"px; background:transparent url("+IMG_URL+"font/12b.png) 0px -"+(s*12)+'px"></div>';q+=k[s]}return'<div style="position:relative; display:inline; height:12px; width:'+q+'px">'+m+"</div>"};function f(m,u,v){var q=m.getElementsByTagName("DIV");var s=new Array("f10l"+u,"f10r"+u,"f12l"+u,"f12r"+u);var t=new Array("f10l"+v,"f10r"+v,"f12l"+v,"f12r"+v);var n=v=="a"?"#0030CB":"#5C0D11";for(var r=0;r<q.length;r++){for(var o=0;o<s.length;o++){q[r].className=q[r].className.replace(s[o],t[o]);q[r].style.color=n}}}var g=undefined;this.set_text_selected=function(n){var m=true;if(g!=undefined){if(g==n){m=false}this.set_text_unselected()}if(m){f(n,"b","a");g=n}};this.set_text_unselected=function(){if(g!=undefined){f(g,"a","b");g=undefined}};function i(q,n){for(var r=[];n>0;r[--n]=q){}return(r.join(""))}this.sprintf=function(){var s=0,r,t=arguments[s++],v=[],q,u,w,n;while(t){if(q=/^[^\x25]+/.exec(t)){v.push(q[0])}else{if(q=/^\x25{2}/.exec(t)){v.push("%")}else{if(q=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)){if(((r=arguments[q[1]||s++])==null)||(r==undefined)){throw ("Too few arguments.")}if(/[^s]/.test(q[7])&&(typeof(r)!="number")){throw ("Expecting number but found "+typeof(r))}switch(q[7]){case"b":r=r.toString(2);break;case"c":r=String.fromCharCode(r);break;case"d":r=parseInt(r);break;case"e":r=q[6]?r.toExponential(q[6]):r.toExponential();break;case"f":r=q[6]?parseFloat(r).toFixed(q[6]):parseFloat(r);break;case"o":r=r.toString(8);break;case"s":r=((r=String(r))&&q[6]?r.substring(0,q[6]):r);break;case"u":r=Math.abs(r);break;case"x":r=r.toString(16);break;case"X":r=r.toString(16).toUpperCase();break}r=(/[def]/.test(q[7])&&q[2]&&r>0?"+"+r:r);w=q[3]?q[3]=="0"?"0":q[3].charAt(1):" ";n=q[5]-String(r).length;u=q[5]?i(w,n):"";v.push(q[4]?r+u:u+r)}else{throw ("Huh ?!")}}}t=t.substring(q[0].length)}return v.join("")};this.hv_debug=function(n){var m=a("debugpane");if(m!=undefined){m.innerHTML=n+"<br />"+m.innerHTML}}}var common=new Common();function RPCSession(){var e=undefined;var d=undefined;try{e=new XMLHttpRequest()}catch(b){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){e=false}}}this.dispatch_request=function(g,h){if(this.url!=undefined){alert("Session already in use")}else{this.url=g;e.open("GET",this.url,true);e.onreadystatechange=function(i){if(i.readyState==4){if(i.status==200){if(h!=undefined){h(i.responseText)}this.url=undefined}else{alert("Server communication failed. Server responded with: "+i.responseText)}}};common.hv_debug("dispatch_request "+g);e.send(null)}}}function get_rpcsession(){return new RPCSession()}function Itembot(){function a(b){return document.getElementById(b)}this.set_selected_item=function(d){var e=a("bot_item");for(var b=0;b<e.options.length;b++){if(e.options[b].value==d){e.selectedIndex=b;e.onchange();break}}};this.update_bidstats=function(){var b=a("bot_item").selectedIndex;a("bot_maxcount").value=curcount[b];a("bot_maxprice").value=curbid[b];a("minprice").innerHTML=common.get_dynamic_digit_string(minprice[b]);a("highbid").innerHTML=common.get_dynamic_digit_string(highbid[b]);common.set_text_unselected()};this.modify_task=function(){a("itembotform").submit()}}function init_itembot(){return new Itembot()}function Shops(){function b(n){return document.getElementById(n)}var j=undefined;var d=0;var f=0;var i=undefined;var e=0;var a=0;var g=false;this.unset_selected_item=function(){common.hv_debug("unset_selected_item");this.set_selected_item(undefined,0,0,0,undefined)};this.set_selected_item=function(s,q,n,r,o){common.hv_debug("set_selected_item = "+s+" "+q+" "+r+" "+n);if(q==d&&q!=0){this.unset_selected_item();return}j=s;d=q;f=Math.min(1,n);e=r;a=n;i=o;k()};this.set_selected_count=function(n){common.hv_debug("set_selected_count = "+n);if(d>0){f=Math.max(0,Math.min(f+n,a))}k()};var h=b("count_field");var m=b("cost_field");var l=b("sum_field");function k(){if(h!=undefined){h.innerHTML=common.get_dynamic_digit_string(f)}if(m!=undefined){m.innerHTML=common.get_dynamic_digit_string(e)}if(l!=undefined){l.innerHTML=common.get_dynamic_digit_string(f*e)}g=true;if(d<1||f<1){common.hv_debug("No item or count");g=false}else{if(j=="shop_pane"){if(f*e>current_credits){common.hv_debug("Insufficient credits");g=false}}}b("accept_button").src=IMG_URL+"shops/accept"+(g?"":"_d")+".png"}this.commit_transaction=function(){if(g){if(confirm("Are you sure you wish to "+(j=="shop_pane"?"purchase":"sell")+" "+f+' "'+i.replace("&#039;","'")+'" for '+common.number_format(f*e)+" credits ?")){b("select_mode").value=j;b("select_item").value=d;b("select_count").value=f;b("shopform").submit()}}else{alert("Transaction cannot be completed as requested")}}}function init_shops(){return new Shops()}function ItemWorld(){var a=function(g){return document.getElementById(g)};var f=0;var d=undefined;var b=false;this.unset_selected_item=function(){common.hv_debug("unset_selected_item");this.set_selected_item(0,undefined)};this.set_selected_item=function(h,g){common.hv_debug("set_selected_item = "+h+" "+g);if(h==f&&h!=0){this.unset_selected_item();return}f=h;d=g;e()};function e(){b=true;if(f<1){common.hv_debug("No item selected");b=false}else{common.hv_debug("Selected item "+f);b=true}a("accept_button").src=IMG_URL+"shops/enteritemworld"+(b?"":"_d")+".png"}this.commit_transaction=function(){if(b){if(confirm('Are you sure you wish to enter the Item World of "'+d+'" ?')){a("select_item").value=f;a("shopform").submit()}}else{alert("Transaction cannot be completed as requested")}}}function init_itemworld(){return new ItemWorld()}function Forge(){var a=function(g){return document.getElementById(g)};var f=0;var d=undefined;var b=false;this.unset_selected_item=function(){common.hv_debug("unset_selected_item");this.set_selected_item(0,undefined)};this.set_selected_item=function(h,g){common.hv_debug("set_selected_item = "+h+" "+g);if(h==f&&h!=0){this.unset_selected_item();return}f=h;d=g;e()};function e(){b=true;if(f<1){common.hv_debug("No item selected");b=false}else{common.hv_debug("Selected item "+f);b=true}a("upgrade_button").src=IMG_URL+"shops/showupgrades"+(b?"":"_d")+".png";a("enchant_button").src=IMG_URL+"shops/showenchants"+(b?"":"_d")+".png";a("salvage_button").src=IMG_URL+"shops/salvage"+(b?"":"_d")+".png";a("reforge_button").src=IMG_URL+"shops/reforge"+(b?"":"_d")+".png"}this.commit_transaction=function(){if(b){a("select_item").value=f;a("shopform").submit()}else{alert("No item selected")}}}function init_forge(){return new Forge()}function Snowflake(){var a=function(l){return document.getElementById(l)};var i=a("pane_info");var b=a("pane_artifact");var e=a("pane_trophy");var d=0;var g=0;var f=undefined;var h=false;var k=["1handed","2handed","staff","shield","acloth","alight","aheavy"];this.unset_selected_item=function(){common.hv_debug("unset_selected_item");this.set_selected_item(0,undefined)};this.set_selected_item=function(m,l){common.hv_debug("set_selected_item = "+m+" "+l);if(m==d&&m!=0){this.unset_selected_item();return}d=m;f=l;j()};this.set_selected_reward=function(n,l){common.hv_debug("set_selected_reward = "+n+" "+l);if(n==g&&n!=0){n=0}g=n;var m=0;for(m=1;m<=7;m++){common.hv_debug("reward_"+m);a("reward_"+m).src=IMG_URL+"shops/"+k[m-1]+(m==n?"_on":"_off")+".png"}j()};function j(){h=true;var l=0;if(d<1){common.hv_debug("No item selected");h=false;l=1}else{if(d>=20000&&d<30000){common.hv_debug("Selected artifact");h=true;l=2}else{if(d>=30000&&d<40000){common.hv_debug("Selected trophy");h=g>0;l=3}}}i.style.display=l==1?"":"none";b.style.display=l==2?"":"none";e.style.display=l==3?"":"none";a("accept_button").src=IMG_URL+"shops/offering"+(h?"":"_d")+".png"}this.commit_transaction=function(){if(h){if(confirm('Are you sure you wish to offer Snowflake a "'+f.replace("&#039;","'")+'" ?')){a("select_item").value=d;a("select_reward").value=g;a("shopform").submit()}}else{alert("Transaction cannot be completed as requested")}}}function init_snowflake(){return new Snowflake()}function MoogleMail(){var b=function(n){return document.getElementById(n)};var j=b("pane_info");var i=b("pane_item");var m=b("pane_equip");var k=b("pane_credhath");var d=0;var h=0;var f=undefined;var e=undefined;var a=0;var g=false;var l=b("accept_button");this.unset_selected_item=function(){common.hv_debug("unset_selected_item");this.set_selected_item(0,undefined)};this.set_selected_item=function(q,n,o){common.hv_debug("set_selected_item = "+q+" "+o);if(q==d&&q!=0){this.unset_selected_item();return}if(q>2){h=1}d=q;e=o;a=n;this.update_shop_displays()};this.set_display_pane=function(n){f=n;this.update_shop_displays()};this.set_selected_count=function(n){var o=undefined;if(n>-1){o=n+"";h=Math.max(0,parseInt(o))}else{o=prompt("How many of this item would you like to attach, kupo?","1");h=Math.max(1,parseInt(o))}};this.update_shop_displays=function(){g=true;var n=0;if(d<1||h<1){common.hv_debug("No item selected");g=false}else{common.hv_debug("Selected item "+d);g=true}if(f=="item"){n=2}else{if(f=="equip"){n=3}else{if(f=="credhath"){n=4}else{n=1}}}j.style.display=n==1?"":"none";i.style.display=n==2?"":"none";m.style.display=n==3?"":"none";k.style.display=n==4?"":"none";l.src=IMG_URL+"mooglemail/attachselected"+(g?"":"_d")+".png";l.style.display=n!=1?"":"none"};this.commit_transaction=function(){if(g){b("action").value="attach_add";b("select_item").value=d;b("select_count").value=h;b("select_pane").value=f;b("mailform").submit()}else{alert("Transaction cannot be completed as requested, kupo!")}};this.mmail_send=function(){var o="";if(attach_count>0){var n=(attach_count==1?"a":attach_count+"x")+' "'+attach_name+'"';if(attach_cod>0){o="You have attached "+n+", and the CoD is set to "+attach_cod+" credits, kupo! "}else{if(attach_id>2){o="YOU ARE ABOUT TO SEND OUT "+n+", BUT YOU HAVE NOT SET A COD, KUPO! The attachment will be a gift, kupo! "}else{o="You are about to send "+attach_name+". "}}}if(confirm(o+"Are you sure you wish to send this message, kupo? Sending it will cost you "+send_cost+" credits, kupo!")){b("action").value="send";b("mailform").submit()}};this.mmail_save=function(){b("action").value="save";b("mailform").submit()};this.mmail_discard=function(){if(confirm("Are you sure you wish to discard this message, kupo?")){b("action").value="discard";b("mailform").submit()}};this.remove_attachment=function(){if(mail_state>0&&attach_cod>0){if(!confirm("Removing this attachment will deduct "+attach_cod+" credits from your account. Are you sure?")){return}}b("action").value="attach_remove";b("mailform").submit()};this.return_mail=function(){b("action").value="return_message";b("mailform").submit()};this.set_cod_amount=function(){var n=prompt("Please set a CoD amount for this item, kupo. The recipient must pay this amount to remove the attachment from this mail, kupo.",attach_cod);if(n){var o=Math.max(0,parseInt(n));b("action").value="attach_cod";b("action_value").value=o;b("mailform").submit()}}}function init_mooglemail(){return new MoogleMail()}function Equips(){var b=0;var d=undefined;this.set_equipmentcopy=function(e,f){b=e;d=f};this.unset_equipmentcopy=function(){b=0;d=undefined};function a(g){if(g.shiftKey||g.altKey){return}var f=(window.event)?g.keyCode:g.which;var h=String.fromCharCode(f);common.hv_debug("key="+f+", keychar="+h+", alt="+g.altKey);if(h=="c"){equips.pop_equipwindow()}}this.pop_equipwindow=function(){if(b>0){var f=MAIN_URL+"pages/showequip.php?eid="+b+"&key="+d;var e=450;var g=500;common.hv_debug("Opening "+f);window.open(f,"_pu"+(Math.random()+"").replace(/0\./,""),"toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width="+e+",height="+g+",left="+((screen.width-e)/2)+",top="+((screen.height-g)/2))}};this.hook_copyevent=function(){document.onkeypress=a};this.unhook_copyevent=function(){document.onkeypress=null};this.toggle_equiplock=function(g,f){var e=f.src.match("padlock_closed");f.src=e?f.src.replace("padlock_closed","padlock_open"):f.src.replace("padlock_open","padlock_closed");var h=get_rpcsession();h.dispatch_request(MAIN_URL+"rpc/rpc_equip.php?act=toggle_lock&eid="+g+"&val="+(e?0:1),undefined)};this.hover_equipslot=function(f){f.style.background="#F2EFDF";f.style.border="1px solid #9B4E03"};this.unhover_equipslot=function(f){f.style.background="";f.style.border="1px solid #5C0D12"}}function init_equips(){var a=new Equips();a.hook_copyevent();return a}function init_equips_nohook(){return new Equips()}function Healer(){var f=function(g){return document.getElementById(g)};var b=f("healform");var e=f("heal_hp");var a=f("heal_mp");var d=f("heal_sp");this.do_heal_hp=function(){e.value="1";b.submit()};this.do_heal_mp=function(){a.value="1";b.submit()};this.do_heal_sp=function(){d.value="1";b.submit()};this.do_heal_all=function(){e.value="1";a.value="1";d.value="1";b.submit()}}function init_healer(){return new Healer()}function Ability(){var b=function(f){return document.getElementById(f)};var d=b("ability_popup_window");var e=b("mainpane");var a=b("abilitydiv");this.show_ability_popup=function(h,g,i){var j=common.findPosWithScroll(h);var f=common.findScrollOffset(a);d.innerHTML='<p style="font-weight:bold; text-align:center">'+g+'</p><p style="text-align:justify">'+i+"</p> ";d.style.left=(j[0]-f[0]-195)+"px";d.style.top=(j[1]-f[1]+2)+"px";d.style.visibility="visible"};this.hide_ability_popup=function(){d.style.visibility="hidden"}}function init_ability(){return new Ability()}function Training(){var e=function(j){return document.getElementById(j)};var a=e("trainform");var i=e("trainid");var h=e("traincancelform");var b=e("traincancelflag");this.start_training=function(j){i.value=j;a.submit()};this.cancel_training=function(){b.value=1;h.submit()};var g=e("progress_bar");var f=e("progress_counter_1");function d(){var j=0;var k=new Date();var n=k.getTime()/1000+time_skew;if(n<end_time){j=100-((end_time-n)*100/total_time)}else{j=100}var l=Math.floor(j);var m=Math.floor((j-l)*100);f.innerHTML=l+"."+(m<10?"0":"")+m;g.style.width=(j*4)+"px";if(n>=end_time){document.location=reload_to}}this.do_progress_bar=function(){if(typeof reload_to!="undefined"){setInterval(d,ticktime)}}}function init_training(){return new Training()}function Montage(){var a=function(f){return document.getElementById(f)};var e=a("montage_form");var d=a("montage_action");var b=a("montage_id");this.start_montage=function(f){d.value="start_montage";b.value=f;e.submit()};this.end_montage=function(){if(confirm("Are you sure you wish end this montage? You will not be able to start a new one for twelve hours.")){d.value="end_montage";b.value=0;e.submit()}};this.do_cooldown=function(){if(typeof gains=="undefined"){return}var g=undefined;var f=0;var j=setInterval(h,500);function h(){var n=new Date();var s=Math.ceil(end_time-n.getTime()/1000-f);if(s>=0){var l=Math.floor(s/3600);var q=Math.floor((s-l*3600)/60);var o=s-(l*3600+q*60);elem.innerHTML=common.get_dynamic_digit_string(common.sprintf("%02d",l)+":"+common.sprintf("%02d",q)+":"+common.sprintf("%02d",o))}else{clearInterval(j);elem.innerHTML=common.get_dynamic_digit_string("0:00:00");e.submit()}if(update_gains){var m=Math.min(1,(timespan-s)/timespan);for(gainkey in gains){if(gains[gainkey]>0){var k="mgain_"+(parseInt(gainkey)+1);var r=common.decimalround(gains[gainkey]*m,4);a(k).innerHTML=common.get_dynamic_digit_string("+"+common.sprintf("%01.4f",common.decimalround(gains[gainkey]*m,4)))}}}}var i=new Date();g=i.getTime();f=start_time_server-Math.floor(g/1000)}}function init_montage(){return new Montage()}function Battle(){var q=function(z){return document.getElementById(z)};var t=q("infopane");var f=new Array(undefined,undefined);var i=new Array(undefined,undefined);var k="log";var a="log";var o=undefined;var m=undefined;var b=undefined;var h=1;var w=0;var y="Battle Time";var u="Choose from the Battle Actions highlighted above, and use them to defeat your enemies listed to the right. When all enemies are reduced to zero Health, you win. If your Health reaches zero, you are defeated.";var s=false;var d=function(z){if(t!=undefined){t.innerHTML=z}};this.set_infopane=function(A,z){d('<div style="padding-bottom:3px"><span style="font-weight:bold">'+A+"</span></div><div>"+z+"</div>")};this.set_infopane_spell=function(C,B,A,z){d('<div style="padding-bottom:3px"><span style="font-weight:bold">'+C+'</span></div><div style="position:relative"><div style="float:left; width:345px"><div style="padding-bottom:3px; padding-right:3px">'+B+'</div><div><span style="font-weight:bold">Requires '+z+' Magic Points to cast.</span></div></div><div style="float:left; width:32px; height:32px; position:relative"><img src="'+IMG_URL+"a/"+A+'.png" style="border:0px; margin:0px; padding:0px; position:absolute; left:3px; top:4px; z-index:3" alt="" /><img src="'+IMG_URL+'at/tile_border.png" style="border:0px; margin:0px; padding:0px; position:absolute; left:-5px; top:-4px; z-index:3" alt="" /></div></div>')};this.set_infopane_skill=function(C,B,A,z){d('<div style="padding-bottom:3px"><span style="font-weight:bold">'+C+'</span></div><div style="position:relative"><div style="padding-bottom:3px">'+B+'</div><div><span style="font-weight:bold">'+(z>0?"Cooldown: "+z+" turns - ":"")+"Requires "+A+"% Overcharge to use.</span></div>")};this.set_infopane_effect=function(C,B,z){var A=undefined;if(z=="autocast"){A="Expires if magic is depleted to below 10%"}else{if(z=="permanent"){A="Permanent until triggered"}else{A="Expires in "+z+" turn"+(z==1?"":"s")}}d('<div style="padding-bottom:3px"><span style="font-weight:bold">'+C+'</span></div><div style="padding-bottom:3px">'+B+'</div><div><span style="font-weight:bold">'+A+".</span></div>")};this.set_infopane_item=function(B,A,z){d('<div style="padding-bottom:3px"><span style="font-weight:bold">'+B+'</span></div><div style="padding-bottom:3px">'+A+'</div><div><span style="font-weight:bold">'+z+" Item</span></div>")};this.lock_infopane=function(z,A){A=parseInt(A);if(i[A]==z&&z.alt!="magic"){f[A]=undefined;i[A]=undefined}else{f[A]=t.innerHTML;i[A]=z}if(A==0){f[1]=undefined;i[1]=undefined}};this.clear_infopane=function(){if(f[0]==undefined){this.set_infopane(y,u)}else{if(f[1]!=undefined){d(f[1])}else{d(f[0])}}};var j=function(z){q("togpane_"+z).style.display="";k=z};var l=function(z){q("togpane_"+z).style.display="none";k=undefined};this.toggle_pane=function(z){if(z==k){this.toggle_default_pane()}else{l(k);j(z)}};this.toggle_default_pane=function(){if(k!=a){l(k);j(a);k=a}};this.toggle_magic_pane=function(){if(k=="magico"){this.toggle_pane("magict")}else{if(k=="magict"){this.toggle_pane("magico")}else{this.toggle_pane(default_magic_pane)}}};this.toggle_magico_pane=function(){this.toggle_pane("magico")};this.toggle_magict_pane=function(){this.toggle_pane("magict")};this.toggle_skill_pane=function(){this.toggle_pane("skill")};this.toggle_item_pane=function(){this.toggle_pane("item")};this.toggle_morph_pane=function(){this.toggle_pane("morph")};var r="attack";var v=0;var n=0;this.set_targetmode=function(z){if(r==z&&z!="magic"){r="attack"}else{r=z}};this.reset_subattack=function(){v=0;n=0;this.set_flashy_magic(undefined)};this.set_hostile_subattack=function(z){if(n==z){n=0}else{n=z}};this.set_friendly_subattack=function(z){if(n==z){v=0;this.touch_and_go()}else{n=z}};this.hover_target=function(A){if(b!=undefined){return}var B=common.findPosWithScroll(A);var z=common.findPosWithScroll(q("monsterpane"));B[0]-=z[0];B[1]-=z[1];g("monster",1).style.left=(B[0]-7)+"px";g("monster",1).style.top=(B[1]+A.offsetHeight/2-3)+"px";g("monster",2).style.left=(B[0]+A.offsetWidth+2)+"px";g("monster",2).style.top=(B[1]+A.offsetHeight/2-3)+"px";g("monster",1).style.visibility="visible";g("monster",2).style.visibility="visible"};this.unhover_target=function(){if(b!=undefined){return}g("monster",1).style.visibility="hidden";g("monster",2).style.visibility="hidden"};this.commit_target=function(z){if(b!=undefined){return}b=z;v=z;this.touch_and_go()};this.touch_and_go=function(){if(!s){s=true;q("battleaction").value=1;q("battle_targetmode").value=r;q("battle_target").value=v;q("battle_subattack").value=n;q("battleform").submit()}};this.battle_continue=function(){q("battleaction").value=0;q("battleform").submit()};var g=function(A,z){return q("ta_"+A+"_"+z)};var e=function(z){z.style.opacity=0};this.set_flashy_action=function(A){this.set_flashy_magic(undefined);var B=A.alt;var z=o;if(o==B){if(B=="magic"){this.set_flashy_magic(undefined)}else{o=undefined}}else{h=1;w=0;o=B}if(z!=undefined){e(g(z,1));e(g(z,2))}};this.set_flashy_magic=function(E,I,B){if(E==undefined){m=undefined;e(g("spellflash",1));e(g("spellflash",2));return}if(B==undefined){B=0}var G=parseInt(E.alt);var A=parseInt(E.id);var K=Math.max(isNaN(G)?0:G,isNaN(A)?0:A);var J=common.findPosWithScroll(E);var H=common.findPosWithScroll(q("leftpane"));J[0]-=H[0];J[1]-=H[1];var D=[0,0];var C=undefined;if(C=q("togpane_"+k)){D=common.findScrollOffset(C);J[0]-=D[0];J[1]-=D[1]}var z=[0,0];var F=undefined;if(F=q(I)){z[0]=F.scrollLeft;z[1]=F.scrollTop}J[0]-=z[0]+B;J[1]-=z[1]+B;if(m==K){m=undefined;e(g("spellflash",1));e(g("spellflash",2))}else{h=1;w=0;m=K;g("spellflash",1).style.left=(J[0]+7)+"px";g("spellflash",1).style.top=(J[1]+0)+"px";g("spellflash",2).style.left=(J[0]+E.offsetWidth)+"px";g("spellflash",2).style.top=(J[1]+0)+"px"}};this.start_flash_loop=function(){setInterval(function(){w=common.decimalround(Math.min(1,Math.max(0,w+0.1*h)),2);if(w==0||w==1){h*=-1}if(o!=undefined){g(o,1).style.opacity=w;g(o,2).style.opacity=w}if(m!=undefined){g("spellflash",1).style.opacity=w;g("spellflash",2).style.opacity=w}if(b!=undefined){g("monster",1).style.opacity=w;g("monster",2).style.opacity=w}if(healthflash=q("healthflash")){healthflash.style.opacity=w}var A=0;var z=undefined;while(z=q("effect_expire_"+ ++A)){z.style.opacity=(0.8-w/2)}},25)};document.onkeydown=function(F){F=F||window.event;var C;if(F.target){C=F.target}else{if(F.srcElement){C=F.srcElement}}if(C.nodeType==3){C=C.parentNode}if(C.tagName=="INPUT"||C.tagName=="TEXTAREA"){return}var G=(F.keyCode)?F.keyCode:F.which;var E=String.fromCharCode(G);var z=undefined;var D=undefined;var A=undefined;var B=-1;switch(G){case 48:case 96:B=0;break;case 49:case 97:B=1;break;case 50:case 98:B=2;break;case 51:case 99:B=3;break;case 52:case 100:B=4;break;case 53:case 101:B=5;break;case 54:case 102:B=6;break;case 55:case 103:B=7;break;case 56:case 104:B=8;break;case 57:case 105:B=9;break}var H=false;if(F.altKey){if(B>=0&&B<10){battle.set_quickbar(B);H=true}}else{if(G==13||G==32){z="ckey_continue"}else{if(B>-1){z="mkey_"+B}else{if((G>=112&&G<=123)||E=="G"||E=="P"){if(k!="item"){z="ckey_items"}if(E=="G"||E=="P"){D="ikey_p"}else{if(F.ctrlKey){D="ikey_n"+(G-111)}else{if(F.shiftKey){D="ikey_s"+(G-111)}else{D="ikey_"+(G-111)}}}}else{if(!F.ctrlKey&&!F.shiftKey){switch(E){case"Q":z="ckey_attack";break;case"W":z="ckey_magic";break;case"E":z="ckey_spirit";break;case"A":z="ckey_skills";break;case"S":z="ckey_items";break;case"D":z="ckey_defend";break;case"F":z="ckey_focus";break;case"R":z="ckey_magic";A="action_recast";break}}}}}if(z||D){common.hv_debug("key="+G+", keychar="+E+", alt="+F.altKey);H=true}if(z){battle.do_quickkey(z,A)}if(D){if(elem=q(D)){elem.onclick();elem.onclick()}}}if(H){F.cancelBubble=true;F.returnValue=false;if(F.stopPropagation){F.stopPropagation();F.preventDefault()}return false}};this.set_quickbar=function(z){var A=undefined;var B=undefined;if(z==0){z=10}if(r!="magic"){A="ckey_magic"}B="action_recast";recast_spell=quickbar_spell[z-1];recast_target=quickbar_self[z-1]?0:-1;this.do_quickkey(A,B)};this.do_quickkey=function(z,B){if(z!=undefined){var A=undefined;if(A=q(z)){A.onclick()}}if(B!=undefined){if(B=="action_recast"){if(recast_spell>0){var D=q(recast_spell);D.onclick();if(recast_target>0){var C=q("mkey_"+(recast_target==10?0:recast_target));if(C!=undefined){C.onclick()}}else{if(recast_target==0){D.onclick()}}}}}}}function init_battle(){var a=new Battle();a.clear_infopane();a.start_flash_loop();return a}function MonsterLab(){var a=function(b){return document.getElementById(b)};this.init_primary_attack=function(){var b=a("selected_patk");if(b!=""){this.set_primary_attack(b)}};this.set_primary_attack=function(b){common.hv_debug("set_primary_attack "+b);var d=a("selected_patk").value;if(d.length>0){common.hv_debug("unset primary_attack "+d);a("patk_"+d).src=IMG_URL+"monster/"+d+".png";a("selected_patk").value=""}if(b.length>0){a("patk_"+b).src=IMG_URL+"monster/"+b+"_a.png";a("selected_patk").value=b}}}function init_monsterlab(){var a=new MonsterLab();return a}function at_display(a){win=window.open();for(var b in a){win.document.write(b+" = "+a[b]+"<br/>")}}function at_show_aux(a,g){var e=document.getElementById(a);var f=document.getElementById(g);var d=(f.at_position=="y")?e.offsetHeight+0:0;var b=(f.at_position=="x")?e.offsetWidth+0:0;for(;e;e=e.offsetParent){d+=e.offsetTop;b+=e.offsetLeft}f.style.position="absolute";f.style.top=d+"px";f.style.left=b+"px";f.style.visibility="visible"}function at_show(){p=document.getElementById(this["at_parent"]);c=document.getElementById(this["at_child"]);at_show_aux(p.id,c.id);clearTimeout(c.at_timeout)}function at_hide(){c=document.getElementById(this["at_child"]);c.at_timeout=setTimeout("document.getElementById('"+c.id+"').style.visibility = 'hidden'",100)}function at_click(){p=document.getElementById(this["at_parent"]);c=document.getElementById(this["at_child"]);if(c.style.visibility!="visible"){at_show_aux(p.id,c.id)}else{c.style.visibility="hidden"}return false}function at_attach(d,f,b,a,e){p=document.getElementById(d);c=document.getElementById(f);p.at_parent=p.id;c.at_parent=p.id;p.at_child=c.id;c.at_child=c.id;p.at_position=a;c.at_position=a;c.style.position="absolute";c.style.visibility="hidden";switch(b){case"click":p.onclick=at_click;p.onmouseout=at_hide;c.onmouseover=at_show;c.onmouseout=at_hide;break;case"hover":p.onmouseover=at_show;p.onmouseout=at_hide;c.onmouseover=at_show;c.onmouseout=at_hide;break}};